{"ast":null,"code":"import _defineProperty from\"/Users/jeongeunchoi/REACT_MIDDLEAGE/image-community/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";var _handleActions;import{createAction,handleAction,handleActions}from\"redux-actions\";import{produce}from\"immer\";import{setCookie,getCookie,deleteCookie}from\"../../shared/Cookie\";import{auth}from\"../../shared/firebase\";import firebase from\"firebase/app\";//액션타입 3가지\nvar LOG_OUT=\"LOG_OUT\";var GET_USER=\"GET_USER\";var SET_USER=\"SET_USER\";// action creators\nvar logOut=createAction(LOG_OUT,function(user){return{user:user};});var getUser=createAction(GET_USER,function(user){return{user:user};});var setUser=createAction(SET_USER,function(user){return{user:user};});//initialState\nvar initialState={user:null,is_login:false};var user_initial={user_name:\"pear111\"};//middleware actions\nvar loginFB=function loginFB(id,pwd){return function(dispatch,getState,_ref){var history=_ref.history;auth.setPersistence(firebase.auth.Auth.Persistence.SESSION).then(function(res){auth.signInWithEmailAndPassword(id,pwd).then(function(user){console.log(user);dispatch(setUser({user_name:user.user.displayName,id:id,user_profile:\"\",uid:user.user.uid}));history.push(\"/\");// Signed in\n// ...\n}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;});});};};var signupFB=function signupFB(id,pwd,user_name){return function(dispatch,getState,_ref2){var history=_ref2.history;auth.createUserWithEmailAndPassword(id,pwd).then(function(user){console.log(user);auth.currentUser.updateProfile({displayName:user_name}).then(function(){dispatch(setUser({user_name:user_name,id:id,user_profile:\"\",uid:user.user.uid}));history.push(\"/\");}).catch(function(error){console.log(error);});// Signed in\n// ...\n}).catch(function(error){var errorCode=error.code;var errorMessage=error.message;console.log(errorCode,errorMessage);// ..\n});};};var loginCheckFB=function loginCheckFB(){return function(dispatch,getState,_ref3){var history=_ref3.history;auth.onAuthStateChanged(function(user){if(user){dispatch(setUser({user_name:user.displayName,user_profile:\"\",id:user.email,uid:user.uid}));}else{dispatch(logOut());}});};};var logoutFB=function logoutFB(){return function(dispatch,getState,_ref4){var history=_ref4.history;auth.signOut().then(function(){dispatch(logOut());history.replace('/');});};};//reducer\nexport default handleActions((_handleActions={},_defineProperty(_handleActions,SET_USER,function(state,action){return produce(state,function(draft){setCookie(\"is_login\",\"success\");draft.user=action.payload.user;//payload를 중간에 거쳐야 한다.\ndraft.is_login=true;});}),_defineProperty(_handleActions,LOG_OUT,function(state,action){return produce(state,function(draft){deleteCookie(\"is_login\");draft.user=null;draft.is_login=false;});}),_defineProperty(_handleActions,GET_USER,function(state,action){return produce(state,function(draft){});}),_handleActions),initialState);// action creator export\nvar actionCreators={logOut:logOut,getUser:getUser,signupFB:signupFB,loginFB:loginFB,loginCheckFB:loginCheckFB,logoutFB:logoutFB};export{actionCreators};","map":{"version":3,"sources":["/Users/jeongeunchoi/REACT_MIDDLEAGE/image-community/src/redux/modules/user.js"],"names":["createAction","handleAction","handleActions","produce","setCookie","getCookie","deleteCookie","auth","firebase","LOG_OUT","GET_USER","SET_USER","logOut","user","getUser","setUser","initialState","is_login","user_initial","user_name","loginFB","id","pwd","dispatch","getState","history","setPersistence","Auth","Persistence","SESSION","then","res","signInWithEmailAndPassword","console","log","displayName","user_profile","uid","push","catch","error","errorCode","code","errorMessage","message","signupFB","createUserWithEmailAndPassword","currentUser","updateProfile","loginCheckFB","onAuthStateChanged","email","logoutFB","signOut","replace","state","action","draft","payload","actionCreators"],"mappings":"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","sourcesContent":["import { createAction, handleAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\n\nimport { setCookie, getCookie, deleteCookie } from \"../../shared/Cookie\";\nimport { auth } from \"../../shared/firebase\";\nimport firebase from \"firebase/app\";\n\n//액션타입 3가지\nconst LOG_OUT = \"LOG_OUT\";\nconst GET_USER = \"GET_USER\";\nconst SET_USER = \"SET_USER\";\n\n// action creators\nconst logOut = createAction(LOG_OUT, (user) => ({ user }));\nconst getUser = createAction(GET_USER, (user) => ({ user }));\nconst setUser = createAction(SET_USER, (user) => ({ user }));\n\n//initialState\nconst initialState = {\n  user: null,\n  is_login: false,\n};\n\nconst user_initial = {\n  user_name: \"pear111\",\n};\n\n//middleware actions\nconst loginFB = (id, pwd) => {\n  return function (dispatch, getState, { history }) {\n    auth.setPersistence(firebase.auth.Auth.Persistence.SESSION).then((res) => {\n      auth\n        .signInWithEmailAndPassword(id, pwd)\n        .then((user) => {\n          console.log(user);\n\n          dispatch(\n            setUser({\n              user_name: user.user.displayName,\n              id: id,\n              user_profile: \"\",\n              uid: user.user.uid,\n            })\n          );\n          history.push(\"/\");\n\n          // Signed in\n          // ...\n        })\n        .catch((error) => {\n          var errorCode = error.code;\n          var errorMessage = error.message;\n        });\n    });\n  };\n};\n\nconst signupFB = (id, pwd, user_name) => {\n  return function (dispatch, getState, { history }) {\n    auth\n      .createUserWithEmailAndPassword(id, pwd)\n      .then((user) => {\n        console.log(user);\n\n        auth.currentUser\n          .updateProfile({\n            displayName: user_name,\n          })\n          .then(() => {\n            dispatch(\n              setUser({ user_name: user_name, id: id, user_profile: \"\", uid: user.user.uid })\n            );\n            history.push(\"/\");\n          })\n          .catch((error) => {\n            console.log(error);\n          });\n        // Signed in\n        // ...\n      })\n      .catch((error) => {\n        var errorCode = error.code;\n        var errorMessage = error.message;\n\n        console.log(errorCode, errorMessage);\n        // ..\n      });\n  };\n};\n\nconst loginCheckFB =() => {\n  return function(dispatch, getState, {history}){\n    auth.onAuthStateChanged((user) => {\n      if(user) {\n        dispatch(\n          setUser({\n            user_name: user.displayName,\n            user_profile: \"\",\n            id: user.email,\n            uid: user.uid,\n          })\n        );\n      }else {\n        dispatch(logOut());\n      }\n    })\n}\n}\n\nconst logoutFB = () =>{\n  return function (dispatch, getState, {history}) {\n    auth.signOut().then(() => {\n      dispatch(logOut());\n      history.replace('/');\n    })\n  }\n}\n\n\n//reducer\n\nexport default handleActions(\n  {\n    [SET_USER]: (state, action) =>\n      produce(state, (draft) => {\n        setCookie(\"is_login\", \"success\");\n        draft.user = action.payload.user; //payload를 중간에 거쳐야 한다.\n        draft.is_login = true;\n      }),\n    [LOG_OUT]: (state, action) =>\n      produce(state, (draft) => {\n        deleteCookie(\"is_login\");\n        draft.user = null;\n        draft.is_login = false;\n      }),\n\n    [GET_USER]: (state, action) => produce(state, (draft) => {}),\n  },\n  initialState\n);\n\n// action creator export\nconst actionCreators = {\n  logOut,\n  getUser,\n  signupFB,\n  loginFB,\n  loginCheckFB,\n  logoutFB,\n};\n\nexport { actionCreators };\n"]},"metadata":{},"sourceType":"module"}