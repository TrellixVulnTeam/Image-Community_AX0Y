{"ast":null,"code":"import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport firebase from \"../../shared/firebase\";\nimport \"firebase/firestore\";\nimport { firestore } from \"../../shared/firebase\";\nimport \"moment\";\nimport moment from \"moment\";\nconst SET_POST = \"SET_POST\";\nconst ADD_POST = \"ADD_POST\";\nconst setPost = createAction(SET_POST, post_list => ({\n  post_list\n}));\nconst addPost = createAction(ADD_POST, post => ({\n  post\n}));\nconst initialState = {\n  list: []\n};\nconst initialPost = {\n  // id: 0,\n  // user_info: {\n  //   user_name: \"joy\",\n  //   user_profile:\n  //     \"ttps://www.vmcdn.ca/f/files/piquenewsmagazine/import/2015-33_news_mtnnews2-1-cd1c0a5e13e77f75.jpg;w=640\",\n  // },\n  image_url: \"ttps://www.vmcdn.ca/f/files/piquenewsmagazine/import/2015-33_news_mtnnews2-1-cd1c0a5e13e77f75.jpg;w=640\",\n  contents: \"\",\n  comment_cnt: 0,\n  insert_dt: moment().format(\"YYY-MM-DD hh:mm:ss\")\n};\n\nconst addPostFB = (contents = \"\") => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const postDB = firestre.collection(\"post\");\n    const _user = getState().user.user;\n    const user_info = {\n      user_name: _user.user_name,\n      user_id: _user.uid,\n      user_profile: _user.user_profile\n    };\n    const _post = { ...initialPost,\n      contents: contents,\n      insert_dt: moment().format(\"YYY-MM-DD hh:mm:ss\")\n    };\n    console.log({ ...user_info,\n      ..._post\n    });\n    return;\n    postDB.add({ ...user_info,\n      ..._post\n    }).then(doc => {}).catch(err => {\n      console.log(\"post 작성에 실패했습니다.\", err);\n    });\n  };\n};\n\nconst getPostFB = () => {\n  return function (dispatch, getState, {\n    history\n  }) {\n    const postDB = firestore.collection(\"post\");\n    postDB.get().then(docs => {\n      let post_list = [];\n      docs.forEach(doc => {\n        let _post = doc.data(); // ['comment_cnt', 'contents',...] 배열로 만들어 줌 \n\n\n        let post = Object.keys(_post).reduce((acc, cur) => {\n          if (cur.indexOf(\"user_\") !== -1) {\n            return { ...acc,\n              user_info: { ...acc.user_info,\n                [cur]: _post[cur]\n              }\n            };\n          }\n\n          return { ...acc,\n            [cur]: _post[cur]\n          };\n        }, {\n          id: doc.id,\n          user_info: {}\n        });\n        post_list.push(post);\n      });\n      console.log(post_list);\n      dispatch(setPost(post_list));\n    });\n  };\n}; //리듀서\n\n\nexport default handleActions({\n  [SET_POST]: (state, action) => produce(state, draft => {\n    draft.list = action.payload.post_list;\n  }),\n  [ADD_POST]: (state, action) => produce(state, draft => {})\n}, initialState);\nconst actionCreators = {\n  setPost,\n  addPost,\n  getPostFB\n};\nexport { actionCreators };","map":{"version":3,"sources":["/Users/jeongeunchoi/REACT_MIDDLEAGE/image-community/src/redux/modules/post.js"],"names":["createAction","handleActions","produce","firebase","firestore","moment","SET_POST","ADD_POST","setPost","post_list","addPost","post","initialState","list","initialPost","image_url","contents","comment_cnt","insert_dt","format","addPostFB","dispatch","getState","history","postDB","firestre","collection","_user","user","user_info","user_name","user_id","uid","user_profile","_post","console","log","add","then","doc","catch","err","getPostFB","get","docs","forEach","data","Object","keys","reduce","acc","cur","indexOf","id","push","state","action","draft","payload","actionCreators"],"mappings":"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","sourcesContent":["import { createAction, handleActions } from \"redux-actions\";\nimport { produce } from \"immer\";\nimport firebase from \"../../shared/firebase\";\nimport \"firebase/firestore\";\nimport { firestore } from \"../../shared/firebase\";\nimport \"moment\"\nimport moment from \"moment\";\n\nconst SET_POST = \"SET_POST\";\nconst ADD_POST = \"ADD_POST\";\n\nconst setPost = createAction(SET_POST, (post_list) => ({ post_list }));\nconst addPost = createAction(ADD_POST, (post) => ({ post }));\n\nconst initialState = {\n  list: [],\n};\n\nconst initialPost = {\n  // id: 0,\n  // user_info: {\n  //   user_name: \"joy\",\n  //   user_profile:\n  //     \"ttps://www.vmcdn.ca/f/files/piquenewsmagazine/import/2015-33_news_mtnnews2-1-cd1c0a5e13e77f75.jpg;w=640\",\n  // },\n  image_url:\n    \"ttps://www.vmcdn.ca/f/files/piquenewsmagazine/import/2015-33_news_mtnnews2-1-cd1c0a5e13e77f75.jpg;w=640\",\n  contents: \"\",\n  comment_cnt: 0,\n  insert_dt: moment().format(\"YYY-MM-DD hh:mm:ss\"),\n  \n};\n\n\nconst addPostFB = (contents=\"\") => {\n  return function (dispatch, getState, {history}){\n\n    const postDB = firestre.collection(\"post\");\n\n    const _user = getState().user.user;\n\n    const user_info ={\n      user_name: _user.user_name,\n      user_id: _user.uid,\n      user_profile: _user.user_profile\n    };\n    const _post = {\n      ...initialPost,\n      contents: contents,\n      insert_dt: moment().format(\"YYY-MM-DD hh:mm:ss\"),\n\n    };\n\n    console.log({...user_info, ..._post });\n\n    return\n\n    postDB.add({...user_info, ..._post}).then((doc)=>{\n\n    }).catch((err) => {\n      console.log(\"post 작성에 실패했습니다.\", err);\n    });\n  }\n\n}\n\n\n\nconst getPostFB = () => {\n  return function (dispatch, getState, { history }) {\n    const postDB = firestore.collection(\"post\");\n\n    postDB.get().then((docs) => {\n\n        let post_list =[];\n      docs.forEach((doc) => {\n        let _post = doc.data();  \n        // ['comment_cnt', 'contents',...] 배열로 만들어 줌 \n        let post = Object.keys(_post).reduce((acc, cur) => {\n            \n\n            if(cur.indexOf(\"user_\") !== -1) {\n                return {...acc, user_info: {...acc.user_info, [cur]: _post[cur]}};\n            }\n            return {...acc, [cur]: _post[cur]}\n        }, {id: doc.id, user_info: {}}\n        );\n        post_list.push(post);\n      });\n\n\n      console.log(post_list);\n      dispatch(setPost(post_list));\n    });\n  };\n};\n\n//리듀서\nexport default handleActions(\n  {\n    [SET_POST]: (state, action) => produce(state, (draft) => {\n        draft.list = action.payload.post_list;\n    }),\n    [ADD_POST]: (state, action) => produce(state, (draft) => {}),\n  },\n  initialState\n);\n\nconst actionCreators = {\n  setPost,\n  addPost,\n  getPostFB,\n};\n\nexport { actionCreators };\n"]},"metadata":{},"sourceType":"module"}